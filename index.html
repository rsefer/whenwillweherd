---
layout: default.njk
title: 'Home'
---

<div class="bg-gray-50">
  <div class="mt-10 mx-auto max-w-7xl px-4 sm:mt-12 sm:px-6 md:mt-16 lg:mt-20 lg:px-8 xl:mt-28">
		<div class="sm:text-center lg:text-left">
			<h1 class="text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
				<span class="block xl:inline">When will we reach</span>
				<span class="block text-indigo-600 xl:inline">Herd Immunity?</span>
			</h1>
			<p class="mt-3 text-base text-gray-500 sm:mt-5 sm:text-lg sm:max-w-xl sm:mx-auto md:mt-5 md:text-xl lg:mx-0">
				Herd immunity is based on 75% at double dosage.
			</p>
		</div>
  </div>
</div>



<select id="select-state">
	<option></option>
	{% for state in data.entitiesList %}
	<option value="{{ state }}">{{ state }}</option>
	{% endfor %}
</select>

<div class="container mx-auto">
	<div id="charts-wrap" class="charts-wrap grid grid-cols-1 md:grid-cols-2 gap-4">
	</div>
</div>

<div class="entity-template">
	<div class="bg-white shadow overflow-hidden sm:rounded-lg">
		<div class="px-4 py-5 sm:px-6">
			<h3 class="entity-title text-lg leading-6 font-medium text-gray-900"></h3>
		</div>
		<div class="entity-chart"></div>
		<div class="border-t border-gray-200">
			<dl>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						Population
					</dt>
					<dd class="entity-population mt-1 text-sm text-gray-900 sm:mt-0">
					</dd>
				</div>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						Vacs Given
					</dt>
					<dd class="mt-1 text-sm text-gray-900 sm:mt-0">
						<div class="entity-vacs-given"></div>
						<div>(<span class="entity-vacs-per-100"></span> per 100)</div>
					</dd>
				</div>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						7 Day Rolling Average
					</dt>
					<dd class="entity-7-day-rolling-average mt-1 text-sm text-gray-900 sm:mt-0">
					</dd>
				</div>
				<div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-1 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">
            Herd Immunity
          </dt>
				</div>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						Remaining Vaccinations Needed
					</dt>
					<dd class="entity-herd-remaining-vacs-needed-double mt-1 text-sm text-gray-900 sm:mt-0">
					</dd>
				</div>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						Days Needed
					</dt>
					<dd class="mt-1 text-sm text-gray-900 sm:mt-0">
						<div class="entity-herd-date-double"></div>
						<div>(<span class="entity-herd-days-needed-double"></span> days)</div>
					</dd>
				</div>
				<div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-1 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">
            Completion
          </dt>
        </div>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						Remaining Vaccinations Needed
					</dt>
					<dd class="entity-completion-remaining-vacs-needed-double mt-1 text-sm text-gray-900 sm:mt-0">
					</dd>
				</div>
				<div class="px-4 py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6">
					<dt class="text-sm font-medium text-gray-500">
						Days Needed
					</dt>
					<dd class="mt-1 text-sm text-gray-900 sm:mt-0">
						<div class="entity-completion-date-double"></div>
						<div>(<span class="entity-completion-days-needed-double"></span> days)</div>
					</dd>
				</div>
			</dl>
		</div>
	</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>

<script>
{{ helpers.js | safe }}

jQuery(document).ready(function($) {

	var urlParams = new URLSearchParams(window.location.search);
	var stateName = urlParams.get('state') || 'Illinois';
	$('#select-state').val(stateName);

	$('body').on('change', '#select-state', function() {
		window.location.href = '/?state=' + this.value;
	});

	var data = {{ data.data | safe }};

	var entities = [
		data.entities.find(entity => entity.name == 'United States'),
		data.entities.find(entity => entity.name == stateName)
	];

	Highcharts.setOptions({
		lang: {
			thousandsSep: ','
		},
		chart: {
			type: 'column'
		},
		plotOptions: {
			series: {
				animation: false
			}
		},
	});

	entities.forEach(function(entity, i) {
		var entityTemplate = $('.entity-template').html();
		$('#charts-wrap').append('<div id="entity-' + i + '" class="entity">' + entityTemplate + '</div>');
		var entityBlock = $('#entity-' + i);
		entityBlock.find('.entity-chart').attr('id', 'entity-chart-' + i);
		entityBlock.find('.entity-title').text(entity.name);
		entityBlock.find('.entity-population').text(numberWithCommas(entity.population));
		entityBlock.find('.entity-vacs-given').text(numberWithCommas(entity.total_vaccinations));
		entityBlock.find('.entity-vacs-per-100').text(entity.total_vaccinations_per_hundred);
		entityBlock.find('.entity-7-day-rolling-average').text(numberWithCommas(entity.rolling_average_7));

		entityBlock.find('.entity-herd-date-double').text(entity.herd_date_double_label);
		entityBlock.find('.entity-herd-days-needed-double').text(entity.herd_days_needed_double);
		if (entity.herd_vacs_needed_double) {
			entityBlock.find('.entity-herd-remaining-vacs-needed-double').text(numberWithCommas(entity.herd_vacs_needed_double));
		}

		entityBlock.find('.entity-completion-date-double').text(entity.completion_date_double_label);
		entityBlock.find('.entity-completion-days-needed-double').text(entity.completion_days_needed_double);
		if (entity.completion_vacs_needed_double) {
			entityBlock.find('.entity-completion-remaining-vacs-needed-double').text(numberWithCommas(entity.completion_vacs_needed_double));
		}
		Highcharts.chart('entity-chart-' + i, {
			title: {
				text: data.labels.lastXDays
			},
			xAxis: {
				categories: entity.days.map(day => day.date.substring(5, day.date.length)),
				labels: {
					step: 4
				}
			},
			series: [
				{
					name: 'Daily Vaccinations',
					type: 'column',
					data: entity.days.map(day => [day.date, parseInt(day.daily_vaccinations)])
				},
				{
					name: '7 Day Rolling Average',
					type: 'spline',
					data: entity.days.map(day => [day.date, parseInt(day.rolling_average_7)])
				}
			],
			tooltip: {
				shared: true
			}
		});
	});

});

function numberWithCommas(x) {
	return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

</script>
